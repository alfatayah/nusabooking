<%- include('../../partials/header.ejs') %>
<body id="page-top">
<!-- Page Wrapper -->
<div id="wrapper">

  <%- include('../../partials/sidebar.ejs') %>

  <!-- Content Wrapper -->
  <div id="content-wrapper" class="d-flex flex-column">

    <!-- Main Content -->
    <div id="content">

      <%- include('../../partials/navbar.ejs') %>

      <!-- Begin Page Content -->
      <div class="container-fluid">
        <%- include('../../partials/message.ejs') %>

        <!-- Page Heading -->
        <h1 class="h3 mb-4 text-gray-800">Booking</h1>
        <!-- End Heading -->

        <!-- nanti di sini diisi table nya -->

        <!-- nanti di sini diisi table nya -->
        <%- include('table_booking.ejs') %>

      </div>
      <!-- /.container-fluid -->

    </div>
    <!-- End of Main Content -->

    <%- include('../../partials/footer.ejs') %>

  </div>
  <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->
</body>
<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
  <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <a class="btn btn-primary" href="login.html">Logout</a>
      </div>
    </div>
  </div>
</div>
<%- include('add_booking.ejs') %>
<%- include('edit_booking.ejs') %>
<%- include('../../partials/dash.ejs') %>

<script>
  $('#dataTable').on('click', '.button-update', function () {
    let id = $(this).data('id');
    let namecustomer = $(this).data('namecustomer');
    let datetimes = $(this).data('datetimes');
    let lokasi = $(this).data('lokasi');
    console.log("customer " , namecustomer)
    $('#edit-booked').modal('show');
    $('.id').val(id);
    $('.namecustomer').val(namecustomer);
    $('.datetimes').val(datetimes);
    $('.lokasi').val(lokasi);
  })
</script>


<script>
    let dataArr = [];
    let dataid = [];
    let key = 1;
    
  function selectedProduk(e) {
    let selected = e.options[e.selectedIndex].getAttribute("data-item");
    const check =  dataArr.includes(selected.split('^')[0])

    if(check == false){
      // NOTE: di dalam string nya gue kasih delimeter ^ [0] = nama produk [1] = id produk
      dataArr.push(selected.split('^')[0]);
      dataid.push(selected.split('^')[1])
 
      let numbering = key++;
      let testproduct = document.getElementById('productbook').value = dataid;
      console.log("testproduct", testproduct)
      var $section =  $('  <div id="section'+numbering+'" class="input-group mb-3"> <input id="item'+ numbering +'" type="text" disabled="disable" class="form-control" >  <input id="itemid'+ numbering +'" type="hidden"  class="form-control" >  <div class="input-group-append"> <button type="button" onclick="removeItem('+ numbering +')" class="btn btn-danger btn-sm"> <i class="fas fa-trash"></i></button></div> </div>');
      $('#productSection').append($section);
      document.getElementById("item" + numbering).value = selected.split('^')[0];
      document.getElementById("itemid" + numbering).value = selected.split('^')[1];
    
    }
  }

  function removeItem (number){
    // remove element yang udah di create dari append
    let element = document.getElementById("section" + number);
 
    let removeData = document.getElementById("item" + number).value;
    let removeId = document.getElementById("itemid" + number).value;
    document.getElementById("product_id").selectedIndex = 0;

    //remove product name dari array dataArr
    const index = dataArr.indexOf(removeData);
    if (index > -1) { 
      dataArr.splice(index, 1); 
    }

    //remove id dari array dataid
    const indexId = dataid.indexOf(removeId);
    if (index > -1) { 
      dataid.splice(indexId, 1); 
    }
    element.remove();
 
  }
</script>